<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Educativo - Hub Gamificado</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        
        .quiz-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            padding: 30px;
            margin-top: 20px;
            backdrop-filter: blur(10px);
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .quiz-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .quiz-header h2 {
            color: #333;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .progress {
            height: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .progress-bar {
            background: linear-gradient(45deg, #667eea, #764ba2);
        }
        
        .question-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            border: 2px solid #e9ecef;
        }
        
        .question-text {
            font-size: 18px;
            font-weight: 500;
            color: #333;
            margin-bottom: 20px;
        }
        
        .answer-option {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .answer-option:hover {
            border-color: #667eea;
            background: #f8f9ff;
            transform: translateY(-2px);
        }
        
        .answer-option.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }
        
        .answer-option.correct {
            border-color: #28a745;
            background: #28a745;
            color: white;
        }
        
        .answer-option.incorrect {
            border-color: #dc3545;
            background: #dc3545;
            color: white;
        }
        
        .quiz-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
        }
        
        .btn-quiz {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            border-radius: 12px;
            padding: 12px 30px;
            font-size: 16px;
            font-weight: 500;
            color: white;
            transition: all 0.3s ease;
        }
        
        .btn-quiz:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }
        
        .btn-quiz:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .score-display {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }
        
        .results-card {
            text-align: center;
            padding: 40px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border-radius: 20px;
            margin-top: 20px;
        }
        
        .results-card h3 {
            font-size: 32px;
            margin-bottom: 20px;
        }
        
        .results-stats {
            display: flex;
            justify-content: space-around;
            margin: 30px 0;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-number {
            font-size: 36px;
            font-weight: 700;
            display: block;
        }
        
        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .timer {
            font-size: 18px;
            font-weight: 600;
            color: #667eea;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .discipline-badge {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 15px;
        }
        
        @media (max-width: 768px) {
            .quiz-container {
                padding: 20px;
                margin: 10px;
            }
            
            .question-text {
                font-size: 16px;
            }
            
            .quiz-controls {
                flex-direction: column;
                gap: 15px;
            }
            
            .results-stats {
                flex-direction: column;
                gap: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="quiz-container">
        <div class="quiz-header">
            <h2><i class="fas fa-question-circle me-2"></i>Quiz Educativo</h2>
            <div class="timer" id="timer">Tempo: 30s</div>
        </div>
        
        <div id="questionArea">
            <div class="progress">
                <div class="progress-bar" id="progressBar" role="progressbar" style="width: 0%"></div>
            </div>
            
            <div class="question-card">
                <div class="discipline-badge" id="disciplineBadge">Matemática</div>
                <div class="question-text" id="questionText">Carregando pergunta...</div>
                <div id="answerOptions"></div>
            </div>
            
            <div class="quiz-controls">
                <div class="score-display">
                    <i class="fas fa-coins text-warning me-1"></i>
                    <span id="currentScore">0</span>
                </div>
                <button class="btn btn-quiz" id="nextBtn" onclick="nextQuestion()" disabled>
                    Próxima <i class="fas fa-arrow-right ms-1"></i>
                </button>
            </div>
        </div>
        
        <div id="resultsArea" style="display: none;">
            <div class="results-card">
                <h3><i class="fas fa-trophy me-2"></i>Parabéns!</h3>
                <p>Você completou o quiz educativo!</p>
                
                <div class="results-stats">
                    <div class="stat-item">
                        <span class="stat-number" id="correctAnswers">0</span>
                        <span class="stat-label">Acertos</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="totalQuestions">0</span>
                        <span class="stat-label">Total</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="earnedCoins">0</span>
                        <span class="stat-label">Moedas</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="earnedXP">0</span>
                        <span class="stat-label">XP</span>
                    </div>
                </div>
                
                <button class="btn btn-light btn-lg" onclick="backToHub()">
                    <i class="fas fa-home me-2"></i>Voltar ao Hub
                </button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Your web app's Firebase configuration - ATUALIZE COM SEUS DADOS
        const firebaseConfig = {
          apiKey: "AIzaSyBYe4oRa-uS1hTodVAsa7Zer1fOAU9-kcA",
          authDomain: "marsflow-english-academy.firebaseapp.com",
          projectId: "marsflow-english-academy",
          storageBucket: "marsflow-english-academy.firebasestorage.app",
          messagingSenderId: "527381031956",
          appId: "1:527381031956:web:495fb3da0a3cea8b864b01",
          measurementId: "G-1NC30HNJLQ"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Variáveis globais
        let currentUser = null;
        let userData = null;
        let currentQuestionIndex = 0;
        let score = 0;
        let correctAnswers = 0;
        let questions = [];
        let selectedAnswer = null;
        let timer = null;
        let timeLeft = 30;

        // Banco de perguntas do quiz
        const quizQuestions = [
            // Matemática
            {
                disciplina: 'Matemática',
                pergunta: 'Qual é o resultado de 15 + 27?',
                opcoes: ['42', '40', '44', '46'],
                correta: 0,
                moedas: 10,
                xp: 5
            },
            {
                disciplina: 'Matemática',
                pergunta: 'Quantos lados tem um triângulo?',
                opcoes: ['2', '3', '4', '5'],
                correta: 1,
                moedas: 10,
                xp: 5
            },
            {
                disciplina: 'Matemática',
                pergunta: 'Qual é a metade de 50?',
                opcoes: ['20', '25', '30', '35'],
                correta: 1,
                moedas: 10,
                xp: 5
            },
            {
                disciplina: 'Matemática',
                pergunta: 'Qual é o dobro de 8?',
                opcoes: ['16', '14', '12', '18'],
                correta: 0,
                moedas: 10,
                xp: 5
            },
            {
                disciplina: 'Matemática',
                pergunta: 'Quantos minutos tem 1 hora?',
                opcoes: ['30', '45', '60', '90'],
                correta: 2,
                moedas: 10,
                xp: 5
            },
            // Português
            {
                disciplina: 'Português',
                pergunta: 'Qual é o plural de "cão"?',
                opcoes: ['Cãos', 'Cães', 'Cões', 'Cães'],
                correta: 1,
                moedas: 10,
                xp: 5
            },
            {
                disciplina: 'Português',
                pergunta: 'Qual é o artigo definido de "casa"?',
                opcoes: ['O', 'A', 'Os', 'As'],
                correta: 1,
                moedas: 10,
                xp: 5
            },
            {
                disciplina: 'Português',
                pergunta: 'Qual é a sílaba tônica de "abacaxi"?',
                opcoes: ['ba', 'ca', 'xi', 'a'],
                correta: 2,
                moedas: 10,
                xp: 5
            },
            {
                disciplina: 'Português',
                pergunta: 'Quantas letras tem o alfabeto português?',
                opcoes: ['23', '24', '25', '26'],
                correta: 3,
                moedas: 10,
                xp: 5
            },
            {
                disciplina: 'Português',
                pergunta: 'Qual é o contrário de "feliz"?',
                opcoes: ['Alegre', 'Contente', 'Triste', 'Agradável'],
                correta: 2,
                moedas: 10,
                xp: 5
            },
            // Ciências
            {
                disciplina: 'Ciências',
                pergunta: 'Qual é o planeta mais próximo do Sol?',
                opcoes: ['Vênus', 'Terra', 'Marte', 'Mercúrio'],
                correta: 3,
                moedas: 15,
                xp: 8
            },
            {
                disciplina: 'Ciências',
                pergunta: 'Quantos sentidos tem o ser humano?',
                opcoes: ['4', '5', '6', '7'],
                correta: 1,
                moedas: 15,
                xp: 8
            },
            {
                disciplina: 'Ciências',
                pergunta: 'Qual é o maior órgão do corpo humano?',
                opcoes: ['Coração', 'Fígado', 'Pele', 'Pulmão'],
                correta: 2,
                moedas: 15,
                xp: 8
            },
            {
                disciplina: 'Ciências',
                pergunta: 'Qual é o estado físico da água a 0°C?',
                opcoes: ['Líquido', 'Sólido', 'Gasoso', 'Plasma'],
                correta: 1,
                moedas: 15,
                xp: 8
            },
            {
                disciplina: 'Ciências',
                pergunta: 'Qual é o gás que respiramos?',
                opcoes: ['Hidrogênio', 'Oxigênio', 'Nitrogênio', 'Carbono'],
                correta: 1,
                moedas: 15,
                xp: 8
            },
            // História
            {
                disciplina: 'História',
                pergunta: 'Quem descobriu o Brasil?',
                opcoes: ['Dom Pedro I', 'Tiradentes', 'Pedro Álvares Cabral', 'Vasco da Gama'],
                correta: 2,
                moedas: 12,
                xp: 6
            },
            {
                disciplina: 'História',
                pergunta: 'Qual é a capital do Brasil?',
                opcoes: ['São Paulo', 'Rio de Janeiro', 'Brasília', 'Salvador'],
                correta: 2,
                moedas: 12,
                xp: 6
            },
            {
                disciplina: 'História',
                pergunta: 'Qual era o nome do Brasil na época do Império?',
                opcoes: ['Brasil', 'Império Brasileiro', 'Nova Lisboa', 'Portugal'],
                correta: 1,
                moedas: 12,
                xp: 6
            },
            {
                disciplina: 'História',
                pergunta: 'Quem proclamou a independência do Brasil?',
                opcoes: ['Dom Pedro I', 'Dom Pedro II', 'Tiradentes', 'Getúlio Vargas'],
                correta: 0,
                moedas: 12,
                xp: 6
            },
            {
                disciplina: 'História',
                pergunta: 'Em que ano o Brasil descobriu?',
                opcoes: ['1492', '1500', '1600', '1400'],
                correta: 1,
                moedas: 12,
                xp: 6
            },
            // Geografia
            {
                disciplina: 'Geografia',
                pergunta: 'Quantos continentes existem?',
                opcoes: ['5', '6', '7', '8'],
                correta: 1,
                moedas: 12,
                xp: 6
            },
            {
                disciplina: 'Geografia',
                pergunta: 'Qual é o maior país do mundo?',
                opcoes: ['Brasil', 'China', 'Canadá', 'Rússia'],
                correta: 3,
                moedas: 12,
                xp: 6
            },
            {
                disciplina: 'Geografia',
                pergunta: 'Qual é o maior oceano?',
                opcoes: ['Atlântico', 'Índico', 'Pacífico', 'Ártico'],
                correta: 2,
                moedas: 12,
                xp: 6
            },
            {
                disciplina: 'Geografia',
                pergunta: 'Qual é a montanha mais alta do mundo?',
                opcoes: ['Monte Everest', 'Monte Kilimanjaro', 'Monte Fuji', 'Monte Branco'],
                correta: 0,
                moedas: 12,
                xp: 6
            },
            {
                disciplina: 'Geografia',
                pergunta: 'Quantos estados tem o Brasil?',
                opcoes: ['25', '26', '27', '28'],
                correta: 2,
                moedas: 12,
                xp: 6
            }
        ];

        // Verificar autenticação
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUser = user;
                await loadUserData();
                iniciarQuiz();
            } else {
                // Usuário não autenticado, voltar ao login
                alert('Você precisa estar logado para jogar!');
                window.location.href = 'index.html';
            }
        });

        // Carregar dados do usuário
        async function loadUserData() {
            if (!currentUser) return;
            
            try {
                const userDoc = await getDoc(doc(db, 'users', currentUser.uid));
                if (userDoc.exists()) {
                    userData = userDoc.data();
                }
            } catch (error) {
                console.error('Erro ao carregar dados do usuário:', error);
            }
        }

        // Iniciar o quiz
        function iniciarQuiz() {
            // Embaralhar perguntas
            questions = [...quizQuestions].sort(() => Math.random() - 0.5);
            currentQuestionIndex = 0;
            score = 0;
            correctAnswers = 0;
            
            mostrarPergunta();
            iniciarTimer();
        }

        // Mostrar pergunta atual
        function mostrarPergunta() {
            if (currentQuestionIndex >= questions.length) {
                finalizarQuiz();
                return;
            }
            
            const pergunta = questions[currentQuestionIndex];
            selectedAnswer = null;
            
            // Atualizar interface
            document.getElementById('disciplineBadge').textContent = pergunta.disciplina;
            document.getElementById('questionText').textContent = pergunta.pergunta;
            document.getElementById('currentScore').textContent = score;
            
            // Criar opções de resposta
            const answerOptions = document.getElementById('answerOptions');
            answerOptions.innerHTML = '';
            
            pergunta.opcoes.forEach((opcao, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'answer-option';
                optionDiv.textContent = opcao;
                optionDiv.onclick = () => selecionarResposta(index);
                answerOptions.appendChild(optionDiv);
            });
            
            // Atualizar progresso
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            
            // Desabilitar botão próximo
            document.getElementById('nextBtn').disabled = true;
        }

        // Selecionar resposta
        function selecionarResposta(index) {
            if (selectedAnswer !== null) return;
            
            selectedAnswer = index;
            const pergunta = questions[currentQuestionIndex];
            const options = document.querySelectorAll('.answer-option');
            
            // Marcar resposta selecionada
            options[index].classList.add('selected');
            
            // Mostrar resposta correta
            setTimeout(() => {
                if (index === pergunta.correta) {
                    options[index].classList.add('correct');
                    score += pergunta.moedas;
                    correctAnswers++;
                } else {
                    options[index].classList.add('incorrect');
                    options[pergunta.correta].classList.add('correct');
                }
                
                // Habilitar botão próximo
                document.getElementById('nextBtn').disabled = false;
            }, 1000);
        }

        // Próxima pergunta
        function nextQuestion() {
            currentQuestionIndex++;
            mostrarPergunta();
        }

        // Iniciar timer
        function iniciarTimer() {
            timeLeft = 30;
            atualizarTimer();
            
            timer = setInterval(() => {
                timeLeft--;
                atualizarTimer();
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    if (currentQuestionIndex < questions.length) {
                        nextQuestion();
                        iniciarTimer();
                    }
                }
            }, 1000);
        }

        // Atualizar timer
        function atualizarTimer() {
            const timerElement = document.getElementById('timer');
            timerElement.textContent = `Tempo: ${timeLeft}s`;
            
            if (timeLeft <= 10) {
                timerElement.style.color = '#dc3545';
            } else {
                timerElement.style.color = '#667eea';
            }
        }

        // Finalizar quiz
        async function finalizarQuiz() {
            clearInterval(timer);
            
            // Calcular recompensas
            const totalQuestions = questions.length;
            const accuracy = (correctAnswers / totalQuestions) * 100;
            const earnedCoins = score;
            const earnedXP = Math.floor(score / 2);
            
            // Atualizar interface com resultados
            document.getElementById('questionArea').style.display = 'none';
            document.getElementById('resultsArea').style.display = 'block';
            
            document.getElementById('correctAnswers').textContent = correctAnswers;
            document.getElementById('totalQuestions').textContent = totalQuestions;
            document.getElementById('earnedCoins').textContent = '+' + earnedCoins;
            document.getElementById('earnedXP').textContent = '+' + earnedXP;
            
            // Atualizar pontuação no Firebase (se não for convidado)
            if (currentUser && currentUser.uid && !currentUser.uid.startsWith('guest_')) {
                try {
                    // Atualizar pontuação do usuário
                    const userRef = doc(db, 'users', currentUser.uid);
                    const userDoc = await getDoc(userRef);
                    
                    if (userDoc.exists()) {
                        const userData = userDoc.data();
                        const novosDados = {
                            coins: (userData.coins || 0) + earnedCoins,
                            experience: (userData.experience || 0) + earnedXP,
                            level: Math.floor(((userData.experience || 0) + earnedXP) / 100) + 1,
                            ultimaAtualizacao: new Date().toISOString()
                        };
                        
                        await setDoc(userRef, novosDados, { merge: true });
                        console.log('Pontuação atualizada no Firebase!');
                    }
                } catch (error) {
                    console.error('Erro ao atualizar pontuação:', error);
                }
            } else if (currentUser && currentUser.uid && currentUser.uid.startsWith('guest_')) {
                // Atualizar dados do convidado localmente
                if (userData) {
                    userData.coins = (userData.coins || 0) + earnedCoins;
                    userData.experience = (userData.experience || 0) + earnedXP;
                    userData.level = Math.floor(((userData.experience || 0) + earnedXP) / 100) + 1;
                }
            }
        }

        // Voltar ao hub
        function backToHub() {
            window.location.href = 'index.html';
        }

        // Adicionar referência global para funções
        window.nextQuestion = nextQuestion;
        window.backToHub = backToHub;

    </script>
</body>
</html>
